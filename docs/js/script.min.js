!function t(e,r,a){function i(s,l){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!l&&u)return u(s,!0);if(n)return n(s,!0);var o=new Error("Cannot find module '"+s+"'");throw o.code="MODULE_NOT_FOUND",o}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return i(r?r:t)},h,h.exports,t,e,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(r,"__esModule",{value:!0}),r.CMath=void 0;var i=t("./Complex"),n=a(i),s=r.CMath={clamp:function(t,e,r){return Math.max(Math.min(t,e),r)},sum:function(t,e){var r=s.clamp(t.re+e.re,4,-4),a=s.clamp(t.im+e.im,4,-4);return(0,n["default"])(r,a)},sub:function(t,e){var r=s.clamp(t.re-e.re,4,-4),a=s.clamp(t.im-e.im,4,-4);return(0,n["default"])(r,a)},mult:function(t,e){var r=s.clamp(t.re*e.re-t.im*e.im,4,-4),a=s.clamp(t.re*e.im+e.re*t.im,4,-4);return(0,n["default"])(r,a)},abs:function(t){return Math.sqrt(t.re*t.re+t.im*t.im)}}},{"./Complex":2}],2:[function(t,e,r){"use strict";function a(t,e){return i[t][e]}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a;for(var i=[],n=-4;n<=4;n++){i[n]=[];for(var s=-4;s<=4;s++)i[n][s]={re:n,im:s}}},{}],3:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){var e=t.split(","),r=parseInt(e[0]),a=parseInt(e[1]);return(0,u["default"])(r,a)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),l=t("./Complex"),u=a(l),o=function(){function t(e){i(this,t),this.playerId=e.playerId,this.partyIndex=e.partyIndex,this.$party=e.$party,this.playerIndex=e.playerIndex,this.$elm=e.$elm,this.job=e.job,this.hp=n(e.hp),this.operation=e.operation,this.power=n(e.power),this.isAlive=!0,this.$elm.attr("data-player-id",this.playerId),this.$elm.attr("data-party-index",this.partyIndex),this.$elm.attr("data-player-index",this.playerIndex),this.$elm.append("<h2>"+this.job+"</h2>"),this.$elm.append('<div class="hp"></div>'),this.$elm.append('<div class="power"></div>'),this.$mapHp=$('<table class="map-hp"></table>'),this.$elm.append(this.$mapHp);for(var r=4;r>=-4;r--){var a=$("<tr></tr>");this.$mapHp.append(a);for(var s=-4;s<=4;s++){var l=$('<td class="cell" data-x="'+s+'" data-y="'+r+'"></td>');a.append(l)}}this.update()}return s(t,[{key:"update",value:function(){this.isAlive?this.$elm.attr("data-alive",1):this.$elm.attr("data-alive",0),this.$elm.find(".hp").text("HP: ("+this.hp.re+", "+this.hp.im+")"),this.$elm.find(".power").text("POW: "+this.operation+"("+this.power.re+", "+this.power.im+")"),this.$elm.find(".map-hp .cell").removeClass("cur").filter('[data-x="'+this.hp.re+'"][data-y="'+this.hp.im+'"]').addClass("cur")}},{key:"activate",value:function(){this.$elm.addClass("active"),this.isActive=!0}},{key:"disactivate",value:function(){this.$elm.removeClass("active"),this.isActive=!1}}]),t}();r["default"]=o},{"./Complex":2}],4:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("./module/Player"),l=a(s),u=t("./module/Complex"),o=a(u),h=t("./module/CMath"),c={SELECT:"select",ATTACK:"attack"},p=function(){function t(){var e=this;i(this,t),this.partyArr=[],this.playerArr=[];var r=0;this.$stage=$(".stage"),this.$stage.find(".party").each(function(t,a){e.partyArr[t]=[],$(a).find(".player").each(function(i,n){var s=$(n),u=s.attr("data-job"),o=s.attr("data-hp"),h=s.attr("data-operation"),c=s.attr("data-power"),p=new l["default"]({playerId:r,partyIndex:t,$party:$(a),playerIndex:i,$elm:s,job:u,hp:o,operation:h,power:c});e.playerArr.push(p),e.partyArr[t][i]=p,r++})}),this.start()}return n(t,[{key:"reset",value:function(){this.playerIndex=null,this.currentPlayer=null,this.currentPlayerIndex=null,this.playerArr.forEach(function(t){t.disactivate()})}},{key:"start",value:function(){this.nextParty()}},{key:"nextParty",value:function(){this.phase=c.SELECT,this.$stage.attr("data-phase",this.phase),null==this.currentPartyIndex?this.currentPartyIndex=0:this.currentPartyIndex<this.partyArr.length-1?this.currentPartyIndex++:this.currentPartyIndex=0,this.attackArr=[],this.nextPlayer()}},{key:"nextPlayer",value:function(){var t=this;if(this.phase){if(this.phase===c.SELECT){if(null==this.currentPlayerIndex)this.currentPlayerIndex=0;else{if(!(this.currentPlayerIndex<this.partyArr[this.currentPartyIndex].length-1))return $(".stage").off(),this.phase=c.ATTACK,this.$stage.attr("data-phase",this.phase),void this.attack();this.currentPlayerIndex++}if(this.prevPlayer=this.currentPlayer,this.currentPlayer=this.partyArr[this.currentPartyIndex][this.currentPlayerIndex],this.prevPlayer&&this.prevPlayer.disactivate(),this.currentPlayer.activate(),!this.currentPlayer.isAlive)return void this.nextPlayer();$(".stage").one("click",'.player[data-alive="1"]',function(e){var r=$(e.currentTarget).attr("data-player-id"),a=t.playerArr[r],i={attacker:t.currentPlayer,target:a,operation:t.currentPlayer.operation,operand:t.currentPlayer.power};t.attackArr.push(i),t.nextPlayer()})}}else;}},{key:"attack",value:function(){var t=this;this.reset();var e=_.last(this.attackArr),r=function(r){return new Promise(function(a){var i,n,s=r.attacker,l=r.target,u=r.operation,c=r.operand;if(u&&("+"===u?n=h.CMath.sum:"-"===u?n=h.CMath.sub:"*"===u&&(n=h.CMath.mult)),l.isAlive){var p=n(l.hp,c);i=Math.sign(h.CMath.abs(p)-h.CMath.abs(l.hp)),l.hp=p}l.hp===(0,o["default"])(0,0)&&(l.isAlive=!1),s.$elm.addClass("attacking"),s.$elm.on("transitionend",function(t){setTimeout(function(){s.$elm.removeClass("attacking")},1e3)}),l.$elm.addClass("attacked"),l.$elm.on("transitionend",function(t){l.update(),setTimeout(function(){l.$elm.removeClass("attacked"),setTimeout(function(){a()},600)},1e3)}),r===e&&t.nextParty()})};this.attackArr.reduce(function(t,e){return t.then(function(){return r(e)})},Promise.resolve())}}]),t}();window.licker=window.licker||{},function(t){t.mainController=new p}(window.licker)},{"./module/CMath":1,"./module/Complex":2,"./module/Player":3}]},{},[4]);
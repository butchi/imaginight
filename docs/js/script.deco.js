!function i(m,a,g){function ii(ai,gi){if(!a[ai]){if(!m[ai]){var im="function"==typeof require&&require;if(!gi&&im)return im(ai,!0);if(mi)return mi(ai,!0);var mm=new Error("Cannot find module '"+ai+"'");throw mm.code="MODULE_NOT_FOUND",mm}var am=a[ai]={exports:{}};m[ai][0].call(am.exports,function(i){var a=m[ai][1][i];return ii(a?a:i)},am,am.exports,i,m,a,g)}return a[ai].exports}for(var mi="function"==typeof require&&require,ai=0;ai<g.length;ai++)ii(g[ai]);return ii}({1:[function(i,m,a){"use strict";function g(i){return i&&i.__esModule?i:{"default":i}}Object.defineProperty(a,"__esModule",{value:!0}),a.CMath=void 0;var ii=i("./Complex"),mi=g(ii),ai=a.CMath={clamp:function(i,m,a){return Math.max(Math.min(i,m),a)},sum:function(i,m){var a=ai.clamp(i.re+m.re,4,-4),g=ai.clamp(i.im+m.im,4,-4);return(0,mi["default"])(a,g)},sub:function(i,m){var a=ai.clamp(i.re-m.re,4,-4),g=ai.clamp(i.im-m.im,4,-4);return(0,mi["default"])(a,g)},mult:function(i,m){var a=ai.clamp(i.re*m.re-i.im*m.im,4,-4),g=ai.clamp(i.re*m.im+m.re*i.im,4,-4);return(0,mi["default"])(a,g)},abs:function(i){return Math.sqrt(i.re*i.re+i.im*i.im)}}},{"./Complex":2}],2:[function(i,m,a){"use strict";function g(i,m){return ii[i][m]}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=g;for(var ii=[],mi=-4;4>=mi;mi++){ii[mi]=[];for(var ai=-4;4>=ai;ai++)ii[mi][ai]={re:mi,im:ai}}},{}],3:[function(i,m,a){"use strict";function g(i){return i&&i.__esModule?i:{"default":i}}function ii(i,m){if(!(i instanceof m))throw new TypeError("Cannot call a class as a function")}function mi(i){var m=i.split(","),a=parseInt(m[0]),g=parseInt(m[1]);return(0,im["default"])(a,g)}Object.defineProperty(a,"__esModule",{value:!0});var ai=function(){function i(i,m){for(var a=0;a<m.length;a++){var g=m[a];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(i,g.key,g)}}return function(m,a,g){return a&&i(m.prototype,a),g&&i(m,g),m}}(),gi=i("./Complex"),im=g(gi),mm=function(){function i(m){ii(this,i),this.playerId=m.playerId,this.partyIndex=m.partyIndex,this.$party=m.$party,this.playerIndex=m.playerIndex,this.$elm=m.$elm,this.job=m.job,this.hp=mi(m.hp),this.operation=m.operation,this.power=mi(m.power),this.isAlive=!0,this.$elm.attr("data-player-id",this.playerId),this.$elm.attr("data-party-index",this.partyIndex),this.$elm.attr("data-player-index",this.playerIndex),this.$elm.append("<h2>"+this.job+"</h2>"),this.$elm.append('<div class="hp"></div>'),this.$elm.append('<div class="power"></div>'),this.$mapHp=$('<table class="map-hp"></table>'),this.$elm.append(this.$mapHp);for(var a=4;a>=-4;a--){var g=$("<tr></tr>");this.$mapHp.append(g);for(var ai=-4;4>=ai;ai++){var gi=$('<td class="cell" data-x="'+ai+'" data-y="'+a+'"></td>');g.append(gi)}}this.update()}return ai(i,[{key:"update",value:function(){this.isAlive?this.$elm.attr("data-alive",1):this.$elm.attr("data-alive",0),this.$elm.find(".hp").text("HP: ("+this.hp.re+", "+this.hp.im+")"),this.$elm.find(".power").text("POW: "+this.operation+"("+this.power.re+", "+this.power.im+")"),this.$elm.find(".map-hp .cell").removeClass("cur").filter('[data-x="'+this.hp.re+'"][data-y="'+this.hp.im+'"]').addClass("cur")}},{key:"activate",value:function(){this.$elm.addClass("active"),this.isActive=!0}},{key:"disactivate",value:function(){this.$elm.removeClass("active"),this.isActive=!1}}]),i}();a["default"]=mm},{"./Complex":2}],4:[function(i,m,a){"use strict";function g(i){return i&&i.__esModule?i:{"default":i}}function ii(i,m){if(!(i instanceof m))throw new TypeError("Cannot call a class as a function")}var mi=function(){function i(i,m){for(var a=0;a<m.length;a++){var g=m[a];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(i,g.key,g)}}return function(m,a,g){return a&&i(m.prototype,a),g&&i(m,g),m}}(),ai=i("./module/Player"),gi=g(ai),im=i("./module/Complex"),mm=g(im),am=i("./module/CMath"),gm={SELECT:"select",ATTACK:"attack"},ia=function(){function i(){var m=this;ii(this,i),this.partyArr=[],this.playerArr=[];var a=0;this.$stage=$(".stage"),this.$stage.find(".party").each(function(i,g){m.partyArr[i]=[],$(g).find(".player").each(function(ii,mi){var ai=$(mi),im=ai.attr("data-job"),mm=ai.attr("data-hp"),am=ai.attr("data-operation"),gm=ai.attr("data-power"),ia=new gi["default"]({playerId:a,partyIndex:i,$party:$(g),playerIndex:ii,$elm:ai,job:im,hp:mm,operation:am,power:gm});m.playerArr.push(ia),m.partyArr[i][ii]=ia,a++})}),this.start()}return mi(i,[{key:"reset",value:function(){this.playerIndex=null,this.currentPlayer=null,this.currentPlayerIndex=null,this.playerArr.forEach(function(i){i.disactivate()})}},{key:"start",value:function(){this.nextParty()}},{key:"nextParty",value:function(){this.phase=gm.SELECT,this.$stage.attr("data-phase",this.phase),null==this.currentPartyIndex?this.currentPartyIndex=0:this.currentPartyIndex<this.partyArr.length-1?this.currentPartyIndex++:this.currentPartyIndex=0,this.attackArr=[],this.nextPlayer()}},{key:"nextPlayer",value:function(){var i=this;if(this.phase){if(this.phase===gm.SELECT){if(null==this.currentPlayerIndex)this.currentPlayerIndex=0;else{if(!(this.currentPlayerIndex<this.partyArr[this.currentPartyIndex].length-1))return $(".stage").off(),this.phase=gm.ATTACK,this.$stage.attr("data-phase",this.phase),void this.attack();this.currentPlayerIndex++}if(this.prevPlayer=this.currentPlayer,this.currentPlayer=this.partyArr[this.currentPartyIndex][this.currentPlayerIndex],this.prevPlayer&&this.prevPlayer.disactivate(),this.currentPlayer.activate(),!this.currentPlayer.isAlive)return void this.nextPlayer();$(".stage").one("click",'.player[data-alive="1"]',function(m){var a=$(m.currentTarget).attr("data-player-id"),g=i.playerArr[a],ii={attacker:i.currentPlayer,target:g,operation:i.currentPlayer.operation,operand:i.currentPlayer.power};i.attackArr.push(ii),i.nextPlayer()})}}else;}},{key:"attack",value:function(){var i=this;this.reset();var m=_.last(this.attackArr),a=function(a){return new Promise(function(g){var ii,mi,ai=a.attacker,gi=a.target,im=a.operation,gm=a.operand;if(im&&("+"===im?mi=am.CMath.sum:"-"===im?mi=am.CMath.sub:"*"===im&&(mi=am.CMath.mult)),gi.isAlive){var ia=mi(gi.hp,gm);ii=Math.sign(am.CMath.abs(ia)-am.CMath.abs(gi.hp)),gi.hp=ia}gi.hp===(0,mm["default"])(0,0)&&(gi.isAlive=!1),ai.$elm.addClass("attacking"),ai.$elm.on("transitionend",function(i){setTimeout(function(){ai.$elm.removeClass("attacking")},1e3)}),gi.$elm.addClass("attacked"),gi.$elm.on("transitionend",function(i){gi.update(),setTimeout(function(){gi.$elm.removeClass("attacked"),setTimeout(function(){g()},600)},1e3)}),a===m&&i.nextParty()})};this.attackArr.reduce(function(i,m){return i.then(function(){return a(m)})},Promise.resolve())}}]),i}();window.licker=window.licker||{},function(i){i.mainController=new ia}(window.licker)},{"./module/CMath":1,"./module/Complex":2,"./module/Player":3}]},{},[4]);